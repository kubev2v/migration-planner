{{- /*
Migratable Count Query Template - Returns count of VMs without Critical concerns.

Template Parameters:
  - ClusterFilter: filter by cluster name
*/ -}}
SELECT COUNT(DISTINCT i."VM ID")
FROM vinfo i
LEFT JOIN concerns c ON i."VM ID" = c."VM_ID" AND c."Category" = 'Critical'
WHERE c."VM_ID" IS NULL
{{- if .ClusterFilter }} AND i."Cluster" = '{{.ClusterFilter}}'{{end}};

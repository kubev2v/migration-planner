{{- /*
Migratable With Warnings Count Query Template - Returns count of VMs with Warning but no Critical concerns.

Template Parameters:
  - ClusterFilter: filter by cluster name
*/ -}}
SELECT COUNT(DISTINCT i."VM ID")
FROM vinfo i
LEFT JOIN concerns crit ON i."VM ID" = crit."VM_ID" AND crit."Category" = 'Critical'
JOIN concerns warn ON i."VM ID" = warn."VM_ID" AND warn."Category" = 'Warning'
WHERE crit."VM_ID" IS NULL
{{- if .ClusterFilter }} AND i."Cluster" = '{{.ClusterFilter}}'{{end}};

{{- /*
Network Query Template - Extracts network data from the fixed schema.

The schema always has vnetwork and dvport tables. LEFT JOIN handles cases
where dvport is empty.

Template Parameters:
  - ClusterFilter: filter by cluster name
  - Limit: max results (0 = unlimited)
  - Offset: skip first N results
*/ -}}
SELECT
    n."Cluster" as "cluster",
    COALESCE(n."Switch", '') as "dvswitch",
    n."Network" as "name",
    'distributed' as "type",
    COALESCE(p."VLAN", '') as "vlanId",
    COUNT(*)::integer as "vmsCount"
FROM vnetwork n
LEFT JOIN dvport p ON n."Network" = p."Port"
WHERE n."Cluster" IS NOT NULL
{{- if .ClusterFilter }} AND n."Cluster" = '{{.ClusterFilter}}'{{end}}
GROUP BY n."Cluster", n."Switch", n."Network", p."VLAN"
{{- if and .Limit (gt .Limit 0) }} LIMIT {{.Limit}}{{end}}
{{- if and .Offset (gt .Offset 0) }} OFFSET {{.Offset}}{{end}};
